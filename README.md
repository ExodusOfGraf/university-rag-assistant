# ğŸ“ Ğ˜Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ ÑĞ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ´Ğ»Ñ ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚Ğ¾Ğ²

RAG-ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ñ ÑƒĞ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼ API Ğ´Ğ»Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ² Ğ»ÑĞ±Ñ‹Ğµ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹.

## ğŸ“‹ ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ

Ğ”Ğ¸Ğ¿Ğ»Ğ¾Ğ¼Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚: **"Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¸Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ ÑĞ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¾Ğ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ´Ğ»Ñ ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑƒÑ‡Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ"**

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ± ÑƒĞ½Ğ¸Ğ²ĞµÑ€ÑĞ¸Ñ‚ĞµÑ‚Ğµ

## ğŸ— ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Telegram Bot   â”‚â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Web Frontend   â”‚â”€â”€â”€â–¶â”‚    RAG API      â”‚â”€â”€â”€â–¶â”‚   LLM Service   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   (FastAPI)     â”‚    â”‚  (Qwen + GPU)   â”‚
                       â”‚                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  POST /chat     â”‚
â”‚  Mobile App     â”‚â”€â”€â”€â–¶â”‚  POST /search   â”‚â”€â”€â”€â–¶â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  GET /groups    â”‚    â”‚    ChromaDB     â”‚
                       â”‚  Admin API      â”‚    â”‚   + sbert       â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞšĞ»ÑÑ‡ĞµĞ²Ğ°Ñ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** RAG API â€” ÑƒĞ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±ÑĞºĞµĞ½Ğ´, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğº Ğ»ÑĞ±Ğ¾Ğ¼Ñƒ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´Ñƒ.

## ğŸ›  Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|-----------|------------|------------|
| RAG API | FastAPI | Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±ÑĞºĞµĞ½Ğ´ |
| LLM | Qwen2.5-7B (GGUF) | Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² |
| Embeddings | sbert_large_nlu_ru | Ğ’ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (Ñ€ÑƒÑÑĞºĞ¸Ğ¹) |
| Vector DB | ChromaDB | Ğ¡ĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº |
| Bot | aiogram 3.x | Telegram ĞºĞ»Ğ¸ĞµĞ½Ñ‚ |
| GPU | llama-cpp-python + CUDA | Ğ£ÑĞºĞ¾Ñ€ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½Ñ„ĞµÑ€ĞµĞ½ÑĞ° |

## ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

```
diploma_rag/
â”œâ”€â”€ rag_service/           # ğŸ”Œ Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ RAG API
â”‚   â”œâ”€â”€ main.py           # FastAPI Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ llm_service/           # ğŸ§  LLM ÑĞµÑ€Ğ²Ğ¸Ñ (GPU)
â”‚   â”œâ”€â”€ main.py           # Qwen inference
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ bot_service/           # ğŸ¤– Telegram Ğ±Ğ¾Ñ‚ (ĞºĞ»Ğ¸ĞµĞ½Ñ‚)
â”‚   â”œâ”€â”€ bot.py            # aiogram Ğ±Ğ¾Ñ‚
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ data/                  # ğŸ“š Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ RAG
â”‚   â”œâ”€â”€ schedules/        # Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ (JSON)
â”‚   â”œâ”€â”€ departments/      # ĞšĞ°Ñ„ĞµĞ´Ñ€Ñ‹
â”‚   â””â”€â”€ info/             # ĞĞ±Ñ‰Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ
â”œâ”€â”€ models/                # ğŸ—‚ ĞœĞ¾Ğ´ĞµĞ»Ğ¸ (Ğ½Ğµ Ğ² git)
â”‚   â”œâ”€â”€ llm/              # GGUF Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ
â”‚   â””â”€â”€ embed/            # sbert
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .env                   # ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
â””â”€â”€ README.md
```

## ğŸš€ Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚

### 1. ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
```bash
git clone https://github.com/your-username/diploma_rag.git
cd diploma_rag
```

### 2. ĞœĞ¾Ğ´ĞµĞ»Ğ¸
```bash
# LLM (Qwen GGUF ~3.5GB)
# Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ: https://huggingface.co/Qwen/Qwen2.5-7B-Instruct-GGUF
# Ğ¤Ğ°Ğ¹Ğ» qwen2.5-7b-instruct-q3_k_m.gguf â†’ models/llm/

# Embeddings
git lfs install
git clone https://huggingface.co/ai-forever/sbert_large_nlu_ru models/embed/sbert_large_nlu_ru
```

### 3. ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
```bash
cp .env.example .env
# ĞÑ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ .env
```

### 4. Ğ—Ğ°Ğ¿ÑƒÑĞº
```bash
docker-compose up --build
```

## ğŸ”Œ RAG API Endpoints

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ

| ĞœĞµÑ‚Ğ¾Ğ´ | Endpoint | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|-------|----------|----------|
| POST | `/chat` | Ğ§Ğ°Ñ‚ Ñ RAG (Ğ¿Ğ¾Ğ¸ÑĞº + Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ) |
| POST | `/search` | ĞŸĞ¾Ğ¸ÑĞº Ğ±ĞµĞ· Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ |
| GET | `/groups` | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ³Ñ€ÑƒĞ¿Ğ¿ |
| GET | `/health` | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ |

### ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸

| ĞœĞµÑ‚Ğ¾Ğ´ | Endpoint | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|-------|----------|----------|
| POST | `/users` | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ |
| GET | `/users/{id}` | ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ |
| PUT | `/users/{id}/group` | Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñƒ |

### ĞĞ´Ğ¼Ğ¸Ğ½ (Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ X-API-Key)

| ĞœĞµÑ‚Ğ¾Ğ´ | Endpoint | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|-------|----------|----------|
| GET | `/admin/stats` | Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° |
| GET | `/admin/users` | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ |
| POST | `/admin/users/{id}/block` | Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ |
| POST | `/admin/users/{id}/unblock` | Ğ Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ |
| POST | `/admin/reload` | ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ |

## ğŸ’¡ ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ API

### Python
```python
import requests

RAG_URL = "http://localhost:8001"

# Ğ§Ğ°Ñ‚
response = requests.post(f"{RAG_URL}/chat", json={
    "message": "ĞšĞ¾Ğ³Ğ´Ğ° ÑĞºĞ·Ğ°Ğ¼ĞµĞ½ Ğ¿Ğ¾ Ñ„Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„Ğ¸Ğ¸?",
    "user_id": "user123",
    "group": "Ğ˜Ğ’Ğ¢-21"
})
print(response.json()["response"])

# ĞŸĞ¾Ğ¸ÑĞº
results = requests.post(f"{RAG_URL}/search", json={
    "query": "ĞºĞ°Ñ„ĞµĞ´Ñ€Ğ° Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸ĞºĞ¸",
    "limit": 5
})
for r in results.json()["results"]:
    print(r["text"])
```

### JavaScript
```javascript
const response = await fetch('http://localhost:8001/chat', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
        message: 'Ğ“Ğ´Ğµ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑÑ Ğ´ĞµĞºĞ°Ğ½Ğ°Ñ‚?',
        user_id: 'web_user_1'
    })
});
const data = await response.json();
console.log(data.response);
```

### cURL
```bash
curl -X POST http://localhost:8001/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ˜Ğ’Ğ¢-21", "user_id": "test"}'
```

## ğŸŒ Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ğ²ĞµĞ±-ÑĞ°Ğ¹Ñ‚Ğ¾Ğ¼

RAG API Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğ´Ğ»Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ñ Ğ»ÑĞ±Ñ‹Ğ¼ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´Ğ¾Ğ¼:

1. **React/Vue/Angular** â€” Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ fetch/axios Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğº `/chat`
2. **Ğ’Ğ¸Ğ´Ğ¶ĞµÑ‚ Ñ‡Ğ°Ñ‚Ğ°** â€” Ğ²ÑÑ‚Ñ€Ğ¾Ğ¹Ñ‚Ğµ iframe Ğ¸Ğ»Ğ¸ JS-Ğ²Ğ¸Ğ´Ğ¶ĞµÑ‚
3. **REST ĞºĞ»Ğ¸ĞµĞ½Ñ‚** â€” Ğ»ÑĞ±Ğ¾Ğ¹ HTTP ĞºĞ»Ğ¸ĞµĞ½Ñ‚

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ²ĞµĞ±-Ñ‡Ğ°Ñ‚Ğ°:
```html
<div id="chat"></div>
<input id="input" placeholder="Ğ—Ğ°Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ...">
<button onclick="send()">ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>

<script>
async function send() {
    const msg = document.getElementById('input').value;
    const res = await fetch('http://localhost:8001/chat', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({message: msg, user_id: 'web'})
    });
    const data = await res.json();
    document.getElementById('chat').innerHTML += `<p>${data.response}</p>`;
}
</script>
```

## ğŸ“ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ² JSON Ñ„Ğ°Ğ¹Ğ»Ğ°Ñ… Ğ² Ğ¿Ğ°Ğ¿ĞºĞµ `data/`. ĞŸĞ¾ÑĞ»Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹:

```bash
# ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· API
curl -X POST http://localhost:8001/admin/reload \
  -H "X-API-Key: your_key"

# Ğ˜Ğ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¾Ğ¹ Ğ±Ğ°Ğ·Ñ‹
rm -rf chroma_db && docker-compose restart rag_service
```

## ğŸ”’ Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

- `RAG_API_KEY` â€” Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ°Ğ´Ğ¼Ğ¸Ğ½ÑĞºĞ¸Ñ… endpoints
- ĞœĞ¾Ğ´ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ° Ğ² API
- Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğ¹ Ğ¸ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ¾Ğº

## ğŸ³ Docker-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞ¾ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ¸Ğ· 3 Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¾Ğ², ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ñ… Ñ‡ĞµÑ€ĞµĞ· Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ÑÑ ÑĞµÑ‚ÑŒ Docker:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Docker Network                                â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  telegram_   â”‚    â”‚  rag_        â”‚    â”‚  llm_        â”‚          â”‚
â”‚  â”‚  bot         â”‚â”€â”€â”€â–¶â”‚  service     â”‚â”€â”€â”€â–¶â”‚  service     â”‚          â”‚
â”‚  â”‚              â”‚    â”‚              â”‚    â”‚              â”‚          â”‚
â”‚  â”‚  Port: -     â”‚    â”‚  Port: 8001  â”‚    â”‚  Port: 8000  â”‚          â”‚
â”‚  â”‚  aiogram     â”‚    â”‚  FastAPI     â”‚    â”‚  FastAPI     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                             â”‚                   â”‚                   â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚                      â”‚  ChromaDB    â”‚    â”‚  Qwen GGUF   â”‚          â”‚
â”‚                      â”‚  + sbert     â”‚    â”‚  + CUDA      â”‚          â”‚
â”‚                      â”‚  (Volume)    â”‚    â”‚  (GPU)       â”‚          â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ñ‹

| ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ | ĞĞ±Ñ€Ğ°Ğ· | ĞŸĞ¾Ñ€Ñ‚ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|-----------|-------|------|------------|
| `llm_service` | nvidia/cuda + llama-cpp | 8000 | LLM Ğ¸Ğ½Ñ„ĞµÑ€ĞµĞ½Ñ Ğ½Ğ° GPU |
| `rag_service` | python:3.10-slim | 8001 | RAG API + ChromaDB + sbert |
| `telegram_bot` | python:3.10-slim | - | Telegram ĞºĞ»Ğ¸ĞµĞ½Ñ‚ |

### Volumes (Ğ¿Ñ€Ğ¸Ğ¼Ğ¾Ğ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ°Ğ¿ĞºĞ¸)

| Volume | ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ | ĞŸÑƒÑ‚ÑŒ Ğ² ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğµ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|--------|-----------|-------------------|------------|
| `./models/llm` | llm_service | `/models/llm` | GGUF Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Qwen |
| `./models/embed` | rag_service | `/models/embed` | sbert Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ |
| `./chroma_db` | rag_service | `/app/chroma_db` | Ğ’ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ğ°Ñ Ğ‘Ğ” |
| `./data` | rag_service | `/app/data` | JSON Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ |

### ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° (depends_on)

```
1. llm_service    â† Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¼ (GPU, Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ ~30 ÑĞµĞº)
2. rag_service    â† Ğ–Ğ´Ñ‘Ñ‚ llm_service (Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° sbert, Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ)
3. telegram_bot   â† Ğ–Ğ´Ñ‘Ñ‚ rag_service (Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº API)
```

## ğŸ”— Ğ¡Ğ²ÑĞ·ĞºĞ° Telegram Ğ±Ğ¾Ñ‚Ğ° Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¾Ğ¹

### ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹

Telegram Ğ±Ğ¾Ñ‚ â€” ÑÑ‚Ğ¾ **Ñ‚Ğ¾Ğ½ĞºĞ¸Ğ¹ ĞºĞ»Ğ¸ĞµĞ½Ñ‚**, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹:
1. ĞŸÑ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
2. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ HTTP-Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğº RAG API
3. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼

```
ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ          Telegram Bot           RAG API            LLM Service
     â”‚                     â”‚                    â”‚                    â”‚
     â”‚  "ĞšĞ¾Ğ³Ğ´Ğ° ÑĞºĞ·Ğ°Ğ¼ĞµĞ½?"   â”‚                    â”‚                    â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚                    â”‚
     â”‚                     â”‚  POST /chat        â”‚                    â”‚
     â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚
     â”‚                     â”‚                    â”‚  1. ĞŸĞ¾Ğ¸ÑĞº Ğ² ChromaDB
     â”‚                     â”‚                    â”‚  2. Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°
     â”‚                     â”‚                    â”‚  POST /generate    â”‚
     â”‚                     â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                     â”‚                    â”‚                    â”‚ Qwen Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚
     â”‚                     â”‚                    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
     â”‚  "Ğ­ĞºĞ·Ğ°Ğ¼ĞµĞ½ 20 ÑĞ½Ğ²."  â”‚                    â”‚                    â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                    â”‚
```

### ĞšĞ¾Ğ´ ÑĞ²ÑĞ·ĞºĞ¸ (bot_service/bot.py)

```python
class RAGClient:
    """HTTP-ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ´Ğ»Ñ RAG API"""
    
    def __init__(self, base_url: str):
        self.base_url = base_url
    
    def chat(self, message: str, user_id: str, group: str = None) -> dict:
        """ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ² RAG API"""
        response = requests.post(
            f"{self.base_url}/chat",
            json={
                "message": message,
                "user_id": user_id,
                "group": group
            }
        )
        return response.json()

# Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°
rag = RAGClient("http://rag_service:8001")

# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞµ
@dp.message(DialogStates.in_chat)
async def handle_chat(msg: types.Message):
    result = rag.chat(msg.text, str(msg.from_user.id), user_group)
    await msg.answer(result["response"])
```

### ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ

```yaml
# docker-compose.yml
bot_service:
  environment:
    - TELEGRAM_TOKEN=${TELEGRAM_TOKEN}      # Ğ¢Ğ¾ĞºĞµĞ½ Ğ±Ğ¾Ñ‚Ğ°
    - ADMIN_USERNAME=${ADMIN_USERNAME}      # Username Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ°
    - RAG_API_URL=http://rag_service:8001   # URL RAG API (Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ÑÑ ÑĞµÑ‚ÑŒ)
```

## ğŸ”„ ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… RAG

### 1. Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğµ)

```
data/*.json â†’ sbert.encode() â†’ Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ñ‹ â†’ ChromaDB
```

### 2. ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°

```
Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ sbert.encode()    â”‚  â† Ğ’ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ°
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChromaDB.query()  â”‚  â† ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğ¸Ñ… Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (cosine similarity)
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ      â”‚  â† "ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚: ... Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ: ..."
â”‚ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Qwen LLM          â”‚  â† Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° Ğ½Ğ° GPU
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
    ĞÑ‚Ğ²ĞµÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
```

## ğŸ›¡ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¼Ğ¾Ğ´ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸

Ğ’ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ° Ğ² RAG API (`/chat` endpoint):

```python
# ĞŸÑ€Ğ¸ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ:
1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ½Ğ° Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ñ (regex Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹)
3. Ğ•ÑĞ»Ğ¸ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğµ:
   - Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸ĞºĞ° Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğ¹
   - ĞŸÑ€Ğ¸ 3 Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸ÑÑ… â€” Ğ°Ğ²Ñ‚Ğ¾Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°
   - Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ 400/403
4. Ğ•ÑĞ»Ğ¸ OK â€” Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° RAG
```

## ğŸ“„ Ğ›Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ

MIT License
