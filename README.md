# 🎓 Интеллектуальная справочная система для студентов

RAG-система на базе Telegram бота для ответов на вопросы студентов университета.

## 📋 Описание

Дипломный проект: **"Разработка интеллектуальной справочной системы для студентов образовательного учреждения"**

Система позволяет студентам получать информацию о:
- 📅 Расписании экзаменов и сессии
- 🏛 Кафедрах и преподавателях
- 📋 Деканате, библиотеке и других службах

## 🏗 Архитектура

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   Telegram      │────▶│   Bot Service   │────▶│   LLM Service   │
│   Пользователь  │◀────│   (Python)      │◀────│   (FastAPI)     │
└─────────────────┘     └────────┬────────┘     └─────────────────┘
                                 │                       │
                        ┌────────▼────────┐     ┌───────▼───────┐
                        │    ChromaDB     │     │  Qwen 2.5-7B  │
                        │  (векторная БД) │     │    (GGUF)     │
                        └────────┬────────┘     └───────────────┘
                                 │
                        ┌────────▼────────┐
                        │ sbert_large_    │
                        │ nlu_ru          │
                        │ (эмбеддинги)    │
                        └─────────────────┘
```

## 🛠 Технологии

| Компонент | Технология | Назначение |
|-----------|------------|------------|
| LLM | Qwen2.5-7B-Instruct (GGUF) | Генерация ответов |
| Embeddings | sbert_large_nlu_ru | Векторизация текста (русский язык) |
| Vector DB | ChromaDB | Хранение и поиск по векторам |
| Backend | FastAPI + llama-cpp-python | API для LLM с GPU ускорением |
| Bot | aiogram 3.x | Telegram бот |
| Контейнеризация | Docker + NVIDIA Container Toolkit | Деплой с GPU |

## 📁 Структура проекта

```
diploma_rag/
├── bot_service/           # Telegram бот
│   ├── bot.py            # Основной код бота
│   ├── moderation.py     # Система модерации
│   └── Dockerfile
├── llm_service/           # LLM API сервис
│   ├── main.py           # FastAPI приложение
│   └── Dockerfile
├── data/                  # Данные для RAG
│   ├── schedules/        # Расписания групп (JSON)
│   ├── departments/      # Информация о кафедрах
│   └── info/             # Общая информация
├── models/                # Модели (не в git)
│   ├── llm/              # GGUF модель Qwen
│   └── embed/            # sbert_large_nlu_ru
├── scripts/               # Вспомогательные скрипты
│   └── load_data.py      # Загрузка данных в ChromaDB
├── chroma_db/             # База векторов (не в git)
├── docker-compose.yml
├── .env                   # Конфигурация (не в git)
└── README.md
```

## 🚀 Установка и запуск

### Требования

- Docker + Docker Compose
- NVIDIA GPU (RTX 3080 или аналог)
- NVIDIA Container Toolkit
- ~10 GB свободного места для моделей

### 1. Клонирование репозитория

```bash
git clone https://github.com/your-username/diploma_rag.git
cd diploma_rag
```

### 2. Скачивание моделей

**LLM модель (Qwen2.5-7B-Instruct GGUF):**
```bash
# Скачать с HuggingFace: https://huggingface.co/Qwen/Qwen2.5-7B-Instruct-GGUF
# Файл: qwen2.5-7b-instruct-q3_k_m.gguf (~3.5 GB)
# Положить в: models/llm/
```

**Embedding модель (sbert_large_nlu_ru):**
```bash
# Клонировать с HuggingFace
git lfs install
git clone https://huggingface.co/ai-forever/sbert_large_nlu_ru models/embed/sbert_large_nlu_ru
```

### 3. Настройка окружения

Создайте файл `.env`:
```env
TELEGRAM_TOKEN=ваш_токен_от_BotFather
ADMIN_USERNAME=ваш_telegram_username
```

### 4. Запуск

```bash
docker-compose up --build
```

Первый запуск займёт время на:
- Сборку образов
- Загрузку модели в GPU
- Индексацию данных в ChromaDB

## 💬 Использование бота

### Команды пользователя

| Команда | Описание |
|---------|----------|
| `/start` | Главное меню |
| `📅 Указать группу` | Выбор учебной группы |
| `💬 Начать диалог` | Начать общение с ботом |
| `🆘 Тех. поддержка` | Создать обращение |

### Команды администратора

| Команда | Описание |
|---------|----------|
| `/admin` | Админ-панель |
| `📋 Тикеты` | Просмотр обращений и нарушений |
| `🚫 Заблокированные` | Управление блокировками |
| `📊 Статистика` | Статистика использования |

## 🔧 Как работает RAG

### 1. Загрузка данных

```
JSON файлы → sbert_large_nlu_ru → векторы → ChromaDB
```

Данные из `data/` преобразуются в векторы и сохраняются в ChromaDB с метаданными (группа, тип, предмет).

### 2. Поиск (Retrieval)

```
Вопрос пользователя → sbert → вектор → ChromaDB → топ-3 релевантных документа
```

Семантический поиск находит документы, похожие по смыслу, а не по ключевым словам.

### 3. Генерация (Generation)

```
Контекст + Вопрос → Qwen LLM → Ответ
```

LLM получает найденный контекст и генерирует ответ на его основе.

## 📊 Система модерации

- **Автоматическое определение нарушений:**
  - 🤬 Нецензурная лексика
  - 😡 Агрессивное поведение
  - ⚠️ Опасный контент

- **Система предупреждений:** 3 нарушения = автоблокировка
- **Тикеты:** Все нарушения и обращения фиксируются

## 📝 Добавление данных

### Расписание группы

Создайте файл `data/schedules/schedule_ГРУППА.json`:
```json
{
  "group": "ИВТ-21",
  "faculty": "Факультет информационных технологий",
  "course": 4,
  "session": "Зимняя сессия 2024-2025",
  "exams": [
    {
      "subject": "Название предмета",
      "date": "2025-01-15",
      "time": "09:00",
      "room": "305",
      "building": "Корпус Б",
      "teacher": "Иванов И.И."
    }
  ]
}
```

### Информация о кафедре

Добавьте в `data/departments/departments.json`:
```json
{
  "name": "Название кафедры",
  "short_name": "КАФ",
  "faculty": "Факультет",
  "building": "Корпус",
  "room": "123",
  "phone": "+7 (495) 123-45-67",
  "email": "kaf@university.ru",
  "head": "ФИО заведующего",
  "head_title": "д.т.н., профессор",
  "work_hours": "Пн-Пт 09:00-17:00"
}
```

После добавления данных перезапустите бота или удалите `chroma_db/` для переиндексации.

## 🔒 Безопасность

- Токен бота и username админа хранятся в `.env` (не в git)
- Модели не загружаются в репозиторий
- База данных исключена из git

## 📄 Лицензия

MIT License

## 👤 Автор

Дипломный проект студента [Ваше имя]
